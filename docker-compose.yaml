services:
  cosmos:
    command:
      [
        "jupyter",
        "lab",
        "--port=8888",
        "--no-browser",
        "--ip=0.0.0.0",
        "--FileCheckpoints.checkpoint_dir=/tmp",
        "--FileContentsManager.delete_to_trash=False",
      ]
    ports:
      - "8888:8888"
    volumes:
      - .:/app
      - /app/.venv
    build:
      context: .
      target: runtime
      dockerfile: Dockerfile
    develop:
      # Create a `watch` configuration to update the appl
      # https://docs.docker.com/compose/file-watch/#compose-watch-versus-bind-mounts
      watch:
        # # Sync the working directory with the `/app` directory in the container
        # - action: sync
        #   path: .
        #   target: /app
        #   # Exclude the project virtual environment â€” it could be for a
        #   # different platform in the container
        #   ignore:
        #     - .venv/

        # Rebuild the image on changes to the `pyproject.toml`
        - action: rebuild
          path: ./pyproject.toml
        - action: rebuild
          path: ./Dockerfile
        - action: rebuild
          path: ./docker-compose.yaml
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
